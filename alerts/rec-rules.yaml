groups:
- name: demo-http-rules
  rules:

  # Requests per second
  - record: job:http_requests:rate5m
    expr: sum(rate(http_requests_total[5m]))

  # Error rate
  - record: job:http_requests:error_ratio
    expr: |
      sum(rate(http_requests_total{status="500"}[5m]))
      /
      sum(rate(http_requests_total[5m]))

  # Average latency
  - record: job:http_request_latency:avg
    expr: |
      sum(rate(http_request_duration_seconds_sum[5m]))
      /
      sum(rate(http_request_duration_seconds_count[5m]))

  # 95th percentile latency
  - record: job:http_request_latency:p95
    expr: |
      histogram_quantile(
        0.95,
        sum by (le) (
          rate(http_request_duration_seconds_bucket[5m])
        )
      )
